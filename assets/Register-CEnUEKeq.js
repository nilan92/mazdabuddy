import{c as z,u as S,r as l,j as e,L as I,C as A,s as i}from"./index-cT8SiIdW.js";import{A as R}from"./arrow-left-Bsg_5xde.js";import{U as w}from"./user-DvvomPP-.js";import{M as U}from"./mail-DoAqnVVT.js";import{L as g}from"./lock-CDeA5_Db.js";import{E as j,a as N}from"./eye-CsIVhJnl.js";const M=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],W=z("building-2",M),H=()=>{const v=S(),[m,p]=l.useState(!1),[s,a]=l.useState({email:"",password:"",confirmPassword:"",fullName:"",username:"",shopName:new URLSearchParams(window.location.hash.split("?")[1]).get("workshop_name")||"",workshopId:new URLSearchParams(window.location.hash.split("?")[1]).get("workshop_id")||""}),r=!!s.workshopId,[n,y]=l.useState(!1),[d,k]=l.useState(!1),[h,c]=l.useState(null),P=async t=>{t.preventDefault(),p(!0),c(null);try{if(!s.shopName)throw new Error("Please enter your Shop Name.");if(s.password!==s.confirmPassword)throw new Error("Passwords do not match.");const{data:o,error:x}=await i.auth.signUp({email:s.email,password:s.password,options:{data:{full_name:s.fullName},emailRedirectTo:window.location.origin+"/mazdabuddy/"}});if(x)throw x;if(!o.user)throw new Error("Connection error during signup.");const C=o.user.id;let u=s.workshopId;if(!u){const{data:L,error:f}=await i.from("tenants").insert({name:s.shopName}).select().single();if(f)throw f;u=L.id}const{error:b}=await i.from("profiles").update({tenant_id:u,role:r?"technician":"admin",full_name:s.fullName,username:s.username.toLowerCase()}).eq("id",C);if(b)throw console.error("Profile link error:",b),new Error("Account created but failed to link to shop. Please contact support.");alert(r?"Joined Workshop! Please sign in.":"Workshop Registered! Welcome to AutoPulse. Please sign in."),v("/login")}catch(o){c(o.message)}finally{p(!1)}},E=async()=>{const{error:t}=await i.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/mazdabuddy/"}});t&&c(t.message)};return e.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-4xl font-black text-white mb-2 tracking-tight",children:[e.jsx("span",{className:"text-cyan-400",children:"AUTO"}),"PULSE"]}),e.jsx("p",{className:"text-slate-400 font-medium tracking-wide",children:"Start your journey."})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-8 shadow-2xl shadow-black/50",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs(I,{to:"/login",className:"text-slate-500 hover:text-white flex items-center gap-2 text-sm",children:[e.jsx(R,{size:14})," Back to Login"]}),e.jsx("span",{className:`text-[10px] px-2 py-1 rounded font-bold uppercase tracking-widest ${r?"bg-emerald-500/10 text-emerald-500":"bg-cyan-500/10 text-cyan-500"}`,children:r?"Staff Invite":"Administrator"})]}),e.jsxs("button",{type:"button",onClick:E,className:"w-full bg-white hover:bg-slate-100 text-slate-900 font-bold py-3.5 rounded-xl transition-all shadow-xl flex items-center justify-center gap-3 active:scale-95 mb-6",children:[e.jsx("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"G",className:"w-5 h-5"}),"SIGN UP WITH GOOGLE"]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-slate-800"})}),e.jsx("div",{className:"relative flex justify-center text-[10px] font-bold uppercase tracking-[0.2em]",children:e.jsx("span",{className:"bg-slate-900 px-3 text-slate-500",children:"OR WITH EMAIL"})})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[h&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 text-red-200 p-3 rounded-lg flex items-center gap-2 text-sm",children:[e.jsx(A,{size:16}),h]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:r?"Joining Workshop":"Workshop / Garage Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{size:16,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{required:!0,type:"text",disabled:r,className:"w-full bg-slate-950 border border-slate-700 text-white rounded-lg p-2.5 pl-10 focus:border-cyan-500 focus:outline-none disabled:opacity-50",value:s.shopName,onChange:t=>a({...s,shopName:t.target.value}),placeholder:"Elite Auto Care"})]})]}),e.jsx("div",{className:"pt-2 border-t border-slate-800 my-4"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Owner Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{size:16,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{required:!0,type:"text",className:"w-full bg-slate-950 border border-slate-700 text-white rounded-lg p-2.5 pl-10 focus:border-cyan-500 focus:outline-none",value:s.fullName,onChange:t=>a({...s,fullName:t.target.value}),placeholder:"John Doe"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Username"}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{size:16,className:"absolute left-3 top-3 text-slate-500 opacity-50"}),e.jsx("input",{required:!0,type:"text",className:"w-full bg-slate-950 border border-slate-700 text-white rounded-lg p-2.5 pl-10 focus:border-cyan-500 focus:outline-none",value:s.username,onChange:t=>a({...s,username:t.target.value}),placeholder:"johndoe123"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{size:16,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{required:!0,type:"email",className:"w-full bg-slate-950 border border-slate-700 text-white rounded-lg p-2.5 pl-10 focus:border-cyan-500 focus:outline-none",value:s.email,onChange:t=>a({...s,email:t.target.value}),placeholder:"john@example.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{size:16,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{required:!0,type:n?"text":"password",className:"w-full bg-slate-950 border border-slate-700 text-white rounded-lg p-2.5 pl-10 pr-10 focus:border-cyan-500 focus:outline-none",value:s.password,onChange:t=>a({...s,password:t.target.value}),placeholder:"••••••••",minLength:6}),e.jsx("button",{type:"button",onClick:()=>y(!n),className:"absolute right-3 top-2.5 text-slate-500 hover:text-white",children:n?e.jsx(j,{size:16}):e.jsx(N,{size:16})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 uppercase mb-1",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{size:16,className:"absolute left-3 top-3 text-slate-500"}),e.jsx("input",{required:!0,type:d?"text":"password",className:"w-full bg-slate-950 border border-slate-700 text-white rounded-lg p-2.5 pl-10 pr-10 focus:border-cyan-500 focus:outline-none",value:s.confirmPassword,onChange:t=>a({...s,confirmPassword:t.target.value}),placeholder:"Re-enter password",minLength:6}),e.jsx("button",{type:"button",onClick:()=>k(!d),className:"absolute right-3 top-2.5 text-slate-500 hover:text-white",children:d?e.jsx(j,{size:16}):e.jsx(N,{size:16})})]})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-cyan-500/20 transition-all disabled:opacity-50 mt-4 active:scale-95 uppercase tracking-widest",children:m?"Processing...":"Initialize Portal"})]})]})]})})};export{H as Register};
