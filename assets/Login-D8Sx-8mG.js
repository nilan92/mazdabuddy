import{u as N,r as o,j as e,C as y,L as h,s as d}from"./index-cT8SiIdW.js";import{U as k}from"./user-DvvomPP-.js";import{L}from"./lock-CDeA5_Db.js";const O=()=>{const b=N(),[u,l]=o.useState(!1),[m,f]=o.useState(""),[x,w]=o.useState(""),[p,a]=o.useState(null),j=async r=>{r.preventDefault(),l(!0),a(null);let s=!1;const i=setTimeout(()=>{s=!0,a("Authentication timed out. The database might be waking up (cold start). Please try again in 10-20 seconds."),l(!1)},6e4);try{let t=m.trim();if(!t.includes("@")){console.log("[Login] Resolving username:",t);const{data:g,error:c}=await d.rpc("get_email_by_username",{input_username:t});if(s)return;if(c){console.error("[RPC Error]",c),a(`Database Error: ${c.message}`),l(!1),clearTimeout(i);return}if(!g){a("Username not found. Please check your spelling."),l(!1),clearTimeout(i);return}t=g,console.log("[Login] Resolved to email:",t)}if(s)return;const{error:n}=await d.auth.signInWithPassword({email:t,password:x});if(s)return;n?(console.error("[Login] Supabase Auth Error:",n),a(n.message)):(console.log("[Login] Success! Session established. Redirecting..."),b("/"))}catch(t){s||(console.error("[Login Catch]",t),a("A network error prevented login. Please check your internet."))}finally{clearTimeout(i),s||l(!1)}},v=async()=>{const r=window.location.origin+"/mazdabuddy/",{error:s}=await d.auth.signInWithOAuth({provider:"google",options:{redirectTo:r,queryParams:{access_type:"offline",prompt:"consent"}}});s&&console.error("Google Login Error:",s.message)};return e.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-4xl font-black text-white mb-2 whitespace-nowrap tracking-tight",children:[e.jsx("span",{className:"text-brand",children:"AUTO"}),"PULSE"]}),e.jsx("p",{className:"text-slate-400 font-medium tracking-wide",children:"Your shop's heartbeat."})]}),e.jsx("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-8 shadow-2xl shadow-black/50",children:e.jsxs("form",{onSubmit:j,className:"space-y-5",children:[p&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/50 text-red-200 p-3 rounded-lg flex items-center gap-2 text-sm",children:[e.jsx(y,{size:16}),p]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-input",className:"block text-xs font-bold text-slate-500 uppercase mb-1 tracking-widest",children:"Email or Username"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-3.5 text-slate-500",children:e.jsx(k,{size:18})}),e.jsx("input",{id:"login-input",name:"username",autoComplete:"username",type:"text",required:!0,className:"w-full bg-slate-950 border border-slate-700 text-white rounded-xl p-3 pl-10 focus:border-brand focus:outline-none transition-all",placeholder:"username or email@example.com",value:m,onChange:r=>f(r.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{htmlFor:"password-input",className:"block text-xs font-bold text-slate-500 uppercase tracking-widest",children:"Password"}),e.jsx(h,{to:"/forgot-password",title:"Forgot Password",className:"text-xs text-brand hover:filter hover:brightness-110 font-bold",children:"FORGOT?"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-3.5 text-slate-500",children:e.jsx(L,{size:18})}),e.jsx("input",{id:"password-input",name:"password",autoComplete:"current-password",type:"password",required:!0,className:"w-full bg-slate-950 border border-slate-700 text-white rounded-xl p-3 pl-10 focus:border-brand focus:outline-none transition-all",placeholder:"••••••••",value:x,onChange:r=>w(r.target.value)})]})]}),e.jsx("button",{type:"submit",disabled:u,className:"group relative w-full btn-brand font-bold py-3.5 rounded-xl shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed active:scale-95 flex items-center justify-center gap-2",children:u?"AUTHENTICATING...":"SIGN IN"}),e.jsxs("div",{className:"relative py-2",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-slate-800"})}),e.jsx("div",{className:"relative flex justify-center text-[10px] font-bold uppercase tracking-[0.2em]",children:e.jsx("span",{className:"bg-slate-900 px-3 text-slate-500",children:"OR CONTINUE WITH"})})]}),e.jsxs("button",{type:"button",onClick:v,className:"w-full bg-white hover:bg-slate-100 text-slate-900 font-bold py-3.5 rounded-xl transition-all shadow-xl flex items-center justify-center gap-3 active:scale-95",children:[e.jsx("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"G",className:"w-5 h-5"}),"GOOGLE LOGIN"]}),e.jsxs("div",{className:"text-center pt-6 border-t border-slate-800",children:[e.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest mb-2",children:"New to AutoPulse?"}),e.jsx(h,{to:"/register",className:"inline-block text-brand hover:filter hover:brightness-110 font-black text-sm tracking-tight",children:"INITIALIZE WORKSHOP PORTAL"})]})]})})]})})};export{O as Login};
