import{c as k,b as w,a as q,r as i,j as e,P as C,T as P,M as S,s as c}from"./index-DsvCX8kd.js";import{u as L}from"./useQuery-DJ7F4Nk1.js";import{R as A}from"./refresh-ccw-DQKp5jhp.js";import{P as M}from"./plus-DvJNUDZH.js";import{S as z}from"./search--rddRdhG.js";import{T as R}from"./trash-2-Cj_pxgt_.js";const E=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],T=k("square-pen",E),F=()=>{const{profile:b}=w(),p=q(),[d,f]=i.useState(""),[g,r]=i.useState(!1),[n,u]=i.useState(null),[s,l]=i.useState({name:"",part_number:"",location:"",stock_quantity:0,min_stock_level:5,price_lkr:0,cost_lkr:0}),{data:j=[],isLoading:x}=L({queryKey:["parts"],queryFn:async()=>{const{data:t,error:a}=await c.from("parts").select("*").order("name");if(a)throw a;return t}}),m=()=>p.invalidateQueries({queryKey:["parts"]}),y=()=>{u(null),l({name:"",part_number:"",location:"",stock_quantity:0,min_stock_level:5,price_lkr:0,cost_lkr:0}),r(!0)},v=t=>{u(t),l({name:t.name,part_number:t.part_number||"",location:t.location||"",stock_quantity:t.stock_quantity,min_stock_level:t.min_stock_level||5,price_lkr:t.price_lkr,cost_lkr:t.cost_lkr}),r(!0)},N=async t=>{if(!confirm("Are you sure you want to delete this part?"))return;const{error:a}=await c.from("parts").delete().eq("id",t);a?alert(a.message):m()},_=async t=>{t.preventDefault();const a={...s,stock_quantity:Number(s.stock_quantity),min_stock_level:Number(s.min_stock_level),price_lkr:Number(s.price_lkr),cost_lkr:Number(s.cost_lkr)};let o;n?o=await c.from("parts").update(a).eq("id",n.id):o=await c.from("parts").insert([{...a,tenant_id:b?.tenant_id}]),o.error?alert("Error: "+o.error.message):(r(!1),m())},h=j.filter(t=>t.name.toLowerCase().includes(d.toLowerCase())||t.part_number&&t.part_number.toLowerCase().includes(d.toLowerCase()));return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Inventory"}),e.jsx("p",{className:"text-slate-400",children:"Track parts, stock levels, and pricing."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"p-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-colors",title:"Refresh",children:e.jsx(A,{size:20,className:x?"animate-spin":""})}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 bg-cyan-600 hover:bg-cyan-500 text-white px-4 py-2 rounded-lg font-medium transition-colors shadow-lg shadow-cyan-500/20",children:[e.jsx(M,{size:20}),"Add Part"]})]})]}),e.jsxs("div",{className:"bg-slate-900/50 backdrop-blur border border-slate-800 rounded-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-800 flex gap-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500",size:20}),e.jsx("input",{type:"text",placeholder:"Search parts by name or number...",value:d,onChange:t=>f(t.target.value),className:"w-full bg-slate-900 border border-slate-700 text-white pl-10 pr-4 py-2 rounded-lg focus:outline-none focus:border-cyan-500"})]})}),x?e.jsx("div",{className:"text-white text-center py-20",children:"Loading inventory..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-900/80 text-slate-400 text-xs uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Part Details"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Location"}),e.jsx("th",{className:"px-6 py-4 font-semibold",children:"Stock Level"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-right",children:"Price (LKR)"}),e.jsx("th",{className:"px-6 py-4 font-semibold text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-800",children:[h.map(t=>e.jsxs("tr",{className:"hover:bg-slate-800/30 transition-colors group",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-slate-800 flex items-center justify-center text-slate-500",children:e.jsx(C,{size:20})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:t.name}),e.jsx("div",{className:"text-xs text-slate-500 font-mono",children:t.part_number})]})]})}),e.jsx("td",{className:"px-6 py-4 text-slate-400 font-mono text-sm",children:t.location||"N/A"}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-semibold ${t.stock_quantity<=(t.min_stock_level||0)?"text-red-400":"text-emerald-400"}`,children:t.stock_quantity}),t.stock_quantity<=(t.min_stock_level||0)&&e.jsx(P,{size:16,className:"text-red-500"})]}),e.jsx("div",{className:"w-24 h-1.5 bg-slate-800 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${t.stock_quantity<=(t.min_stock_level||0)?"bg-red-500":"bg-emerald-500"}`,style:{width:`${Math.min(t.stock_quantity/20*100,100)}%`}})})]}),e.jsxs("td",{className:"px-6 py-4 text-right font-mono text-slate-300",children:[t.price_lkr.toLocaleString()," LKR",e.jsxs("div",{className:"text-[10px] text-slate-600",children:["Cost: ",t.cost_lkr.toLocaleString()]})]}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>v(t),className:"p-1.5 text-slate-400 hover:text-cyan-400 hover:bg-slate-700 rounded transition-colors",title:"Edit",children:e.jsx(T,{size:16})}),e.jsx("button",{onClick:()=>N(t.id),className:"p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-700 rounded transition-colors",title:"Delete",children:e.jsx(R,{size:16})})]})})]},t.id)),h.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-slate-500",children:'No parts found. Click "Add Part" to create one.'})})]})]})})]}),e.jsx(S,{isOpen:g,onClose:()=>r(!1),title:n?"Edit Part":"Add New Part",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Part Name *"}),e.jsx("input",{type:"text",required:!0,className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.name,onChange:t=>l({...s,name:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Part Number"}),e.jsx("input",{type:"text",className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.part_number,onChange:t=>l({...s,part_number:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Bin/Shelf Location"}),e.jsx("input",{type:"text",className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.location,onChange:t=>l({...s,location:t.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Stock Quantity *"}),e.jsx("input",{type:"number",min:"0",required:!0,className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.stock_quantity,onChange:t=>l({...s,stock_quantity:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Min. Alert Level"}),e.jsx("input",{type:"number",min:"0",required:!0,className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.min_stock_level,onChange:t=>l({...s,min_stock_level:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-slate-800",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Cost Price (LKR) *"}),e.jsx("input",{type:"number",min:"0",step:"0.01",required:!0,className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.cost_lkr,onChange:t=>l({...s,cost_lkr:Number(t.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-1",children:"Selling Price (LKR) *"}),e.jsx("input",{type:"number",min:"0",step:"0.01",required:!0,className:"w-full bg-slate-800 border border-slate-700 text-white rounded-lg p-2.5 focus:border-cyan-500 focus:outline-none",value:s.price_lkr,onChange:t=>l({...s,price_lkr:Number(t.target.value)})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-4 py-2 text-slate-400 hover:text-white font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-medium shadow-lg shadow-cyan-500/20 transition-all",children:n?"Update Part":"Add Part"})]})]})})]})};export{F as Inventory};
