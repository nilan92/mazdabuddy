import{c as g,u as j,a as f,b as N,j as e,U as y,s as d}from"./index-wYOFnSv_.js";import{u as w}from"./useQuery--EpIgSbT.js";import{R as k}from"./refresh-ccw-dAcAs_5I.js";import{D as _,B as C}from"./dollar-sign-BonTQvl5.js";const S=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],J=g("activity",S),r=({title:l,value:n,subtext:o,icon:a,color:t})=>e.jsxs("div",{className:"bg-slate-900/50 backdrop-blur border border-slate-800 p-4 rounded-2xl relative overflow-hidden group",children:[e.jsx("div",{className:`absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity ${t}`,children:e.jsx(a,{size:48})}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`p-2 rounded-xl ${t} bg-opacity-10 text-white`,children:e.jsx(a,{size:20,className:t.replace("bg-","text-")})}),e.jsx("h3",{className:"text-slate-400 font-medium text-sm",children:l})]}),e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:n}),e.jsx("div",{className:"text-xs text-slate-500",children:o})]}),c=()=>e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 p-6 rounded-2xl animate-pulse h-32",children:[e.jsx("div",{className:"h-8 w-8 bg-slate-800 rounded-lg mb-4"}),e.jsx("div",{className:"h-8 w-24 bg-slate-800 rounded mb-2"}),e.jsx("div",{className:"h-4 w-16 bg-slate-800 rounded"})]}),A=()=>{const l=j(),n=f(),{profile:o}=N(),{data:a,isLoading:t,isFetching:b}=w({queryKey:["dashboard"],queryFn:async()=>{const{data:s,error:h}=await d.rpc("get_dashboard_stats");if(h)return console.error("Stats Error:",h),{stats:null,recentJobs:[],lowStock:[]};const{data:p}=await d.from("job_cards").select("*, vehicles(license_plate, make, model)").order("created_at",{ascending:!1}).limit(5),{data:v}=await d.from("parts").select("*").lte("stock_quantity",5).limit(5);return{stats:{revenue:s.monthly_revenue||0,activeJobs:s.active_jobs||0,totalCustomers:s.total_customers||0,completedMonth:s.completed_jobs_month||0,efficiency:"98%"},recentJobs:p||[],lowStock:v||[]}}}),u=()=>n.invalidateQueries({queryKey:["dashboard"]}),i=a?.stats||{revenue:0,activeJobs:0,totalCustomers:0,efficiency:"0%"},x=a?.recentJobs||[],m=a?.lowStock||[];return e.jsxs("div",{className:"p-2 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Dashboard"}),e.jsxs("p",{className:"text-slate-400",children:["Welcome back, ",o?.full_name?.split(" ")[0]||"Member",". Here's what's happening today."]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:u,className:"p-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl transition-all active:scale-95",title:"Refresh Dashboard",children:e.jsx(k,{size:20,className:t||b?"animate-spin":""})}),e.jsx("button",{onClick:()=>l("/scan"),className:"px-4 py-2.5 btn-brand rounded-xl font-bold shadow-lg active:scale-95",children:"Scanning Tool"}),e.jsx("button",{onClick:()=>l("/jobs"),className:"px-4 py-2.5 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold transition-all active:scale-95",children:"+ New Job"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6",children:t?e.jsxs(e.Fragment,{children:[e.jsx(c,{}),e.jsx(c,{}),e.jsx(c,{}),e.jsx(c,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{title:"Monthly Revenue",value:`LKR ${i.revenue.toLocaleString()}`,subtext:"Invoices this month",icon:_,color:"text-emerald-400"}),e.jsx(r,{title:"Active Jobs",value:i.activeJobs,subtext:"Currently on floor",icon:C,color:"text-brand bg-brand-soft"}),e.jsx(r,{title:"Total Customers",value:i.totalCustomers,subtext:"Registered clients",icon:y,color:"text-violet-400"}),e.jsx(r,{title:"Efficiency",value:i.efficiency,subtext:"Shop performance",icon:J,color:"text-amber-400"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-slate-900/50 border border-slate-800 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"Recent Activity"}),t?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-16 bg-slate-800/50 rounded-xl animate-pulse"},s))}):e.jsxs("div",{className:"space-y-4",children:[x.map(s=>e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center font-bold text-slate-300",children:s.vehicles?.make?.substring(0,2).toUpperCase()||"MZ"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-medium",children:[s.vehicles?.make," ",s.vehicles?.model," (",s.vehicles?.license_plate,")"]}),e.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:s.description})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap ${s.status==="completed"?"bg-emerald-500/10 text-emerald-400":"bg-brand-soft text-brand"}`,children:s.status.replace("_"," ")})]},s.id)),x.length===0&&e.jsx("div",{className:"text-slate-500 text-center py-4",children:"No recent activity"})]})]}),e.jsxs("div",{className:"bg-slate-900/50 border border-slate-800 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-6",children:"Low Stock Alert"}),t?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsx("div",{className:"h-12 bg-slate-800/50 rounded-lg animate-pulse"},s))}):e.jsxs("div",{className:"space-y-3",children:[m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-slate-800 bg-slate-800/30",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-slate-200",children:s.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Part #: ",s.part_number]})]}),e.jsxs("div",{className:"text-red-400 text-sm font-bold",children:[s.stock_quantity," Left"]})]},s.id)),m.length===0&&e.jsx("div",{className:"text-slate-500 text-center py-4",children:"Inventory looks good!"})]})]})]})]})};export{A as Dashboard};
